{#if match}
  {#if component}
    <svelte:component this={component} match={match}/>
  {:else}
    <slot></slot>
  {/if}
{/if}

<script>
import { getHistory, matchPath, ROUTE_MATCH } from './index.js';
import { writable } from 'svelte/store.js';
import { setContext, onDestroy } from 'svelte';

export let path = '';
export let exact = false;
export let strict = false;
export let match;
export let component;

const history = getHistory();
const matchStore = writable(null);
let pathname = history.location.pathname;

$: match = matchPath(pathname, { path, exact, strict });
$: matchStore.set(match);

setContext(ROUTE_MATCH, matchStore);

const unlisten = history.listen(location => {
  pathname = location.pathname;
});

onDestroy(unlisten);
</script>
